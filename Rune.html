<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>每日盧恩三符占卜</title>
  <meta name="description" content="每日三符占卜（過去 / 現在 / 未來）— Elder Futhark 24 符文">
  <link rel="manifest" href="manifest.json">
  <style>
    :root{
      --bg1: linear-gradient(180deg,#0f1014,#15151b);
      --card-bg: rgba(255,255,255,0.03);
      --muted: #bdbdbd;
      --accent: #ffd580;
    }
    html,body{height:100%;margin:0;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Noto Sans TC','PingFang TC','Microsoft JhengHei',sans-serif;background:var(--bg1);color:#fff}
    .wrap{max-width:920px;margin:0 auto;padding:18px}
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;gap:12px}
    h1{font-size:18px;margin:0}
    .controls{display:flex;gap:8px;flex-wrap:wrap}
    button{background:rgba(255,255,255,0.06);border:0;padding:8px 12px;border-radius:10px;color:#fff;cursor:pointer;font-weight:600}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:12px}
    .card{border-radius:12px;min-height:180px;padding:14px;box-shadow:0 8px 30px rgba(0,0,0,0.5);display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;background:var(--card-bg);position:relative;overflow:hidden}
    .card .rune{font-size:60px;line-height:1;margin:6px 0 4px 0}
    .card .title{font-weight:700}
    .card .kw{font-style:italic;color:var(--muted);margin-top:6px}
    .card .desc{margin-top:8px;color:#eee;line-height:1.45;font-size:14px;padding:0 6px}
    .small{font-size:13px;color:var(--muted);text-align:center;margin-top:10px}
    .bg-fallback{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));}
    .card::after{content:"";position:absolute;inset:0;background:linear-gradient(180deg, rgba(0,0,0,0.35), rgba(0,0,0,0.45));pointer-events:none}
    @media (max-width:420px){ .card .rune{font-size:46px} .card{min-height:150px;padding:12px} h1{font-size:16px} }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>每日盧恩 — 三符占卜</h1>
      <div class="controls">
        <button id="dailyBtn">今日三符</button>
        <button id="randomBtn">隨機三符</button>
        <button id="allBtn">查看全部符文</button>
      </div>
    </header>

    <main id="grid" class="grid" aria-live="polite"></main>

    <div id="info" class="small"></div>
    <div style="height:20px;"></div>
  </div>

<script>
const RUNES = [
  {sym:'ᚠ',name:'Fehu',sound:'F',keywords:'財富、資源',desc:'物質與能量的流入；管理資源與行動。',bg:'img_0058.jpeg'},
  {sym:'ᚢ',name:'Uruz',sound:'U',keywords:'力量、生命力',desc:'原始力量與康健，面對挑戰的勇氣。',bg:'img_0059.jpeg'},
  {sym:'ᚦ',name:'Thurisaz',sound:'Th',keywords:'守護、衝突',desc:'警惕與防衛；面對阻礙時保持冷靜。',bg:'img_0060.jpeg'},
  {sym:'ᚨ',name:'Ansuz',sound:'A',keywords:'智慧、溝通',desc:'信息、靈感與溝通的力量。',bg:'img_0061.jpeg'},
  // 其他符文資料...
];

function getParam(k){ try{ return new URLSearchParams(location.search).get(k) }catch(e){ return null } }
function todayString(tzMin=null){
  const d = new Date();
  if(tzMin!==null){
    const utc = d.getTime() + d.getTimezoneOffset()*60000;
    const local = new Date(utc + tzMin*60000);
    return local.toISOString().slice(0,10);
  }
  return d.toISOString().slice(0,10);
}
function hash32(str){
  let h = 2166136261 >>> 0;
  for(let i=0;i<str.length;i++){
    h ^= str.charCodeAt(i);
    h = Math.imul(h, 16777619) >>> 0;
  }
  return h;
}
function pickIndex(seed){
  return hash32(seed) % RUNES.length;
}

function makeCard(slotName, rune){
  const div = document.createElement('div');
  div.className = 'card';
  div.style.backgroundImage = `url('${rune.bg}')`;
  div.style.backgroundSize = 'cover';
  div.style.backgroundPosition = 'center';
  div.innerHTML = `
    <div class="title">${slotName}</div>
    <div class="rune">${rune.sym}</div>
    <div class="title">${rune.name}（${rune.sound}）</div>
    <div class="kw">${rune.keywords}</div>
    <div class="desc">${rune.desc}</div>
  `;
  return div;
}

function dailyThree(){
  const user = getParam('user') || '';
  const tz = getParam('tz');
  const tzMin = tz ? parseInt(tz,10) : null;
  const day = todayString(tzMin);
  const base = day + '|' + user;
  const slots = ['過去','現在','未來'];
  const out = document.getElementById('grid');
  out.innerHTML = '';
  for(let i=0;i<3;i++){
    const seed = base + '|' + i;
    const idx = pickIndex(seed);
    const rune = RUNES[idx];
    out.appendChild(makeCard(slots[i], rune));
  }
  setInfo(`今日三符（${day}）  — 種子: ${user?user:'無'}`);
}

function randomThree(){
  const out = document.getElementById('grid');
  out.innerHTML = '';
  const slots = ['過去','現在','未來'];
  for(let i=0;i<3;i++){
    const idx = Math.floor(Math.random()*RUNES.length);
    const rune = RUNES[idx];
    out.appendChild(makeCard(slots[i], rune));
  }
  setInfo(`隨機三符 — ${new Date().toLocaleString()}`);
}

function showAll(){
  const out = document.getElementById('grid');
  out.innerHTML = '';
  RUNES.forEach(r=>{
    out.appendChild(makeCard(r.name, r));
  });
  setInfo('所有 24 個符文');
}

function setInfo(txt){ document.getElementById('info').textContent = txt; }

document.getElementById('dailyBtn').addEventListener('click', dailyThree);
document.getElementById('randomBtn').addEventListener('click', randomThree);
document.getElementById('allBtn').addEventListener('click', showAll);

dailyThree();
</script>
</body>
</html>
